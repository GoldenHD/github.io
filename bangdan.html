<!DOCTYPE html>
<html lang="zh-cmn-Hans">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸¸æˆæ¦œå•ç®¡ç† - æ¸¸æˆå¸‚åœºåˆ†æ</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 50%, #0f3460 100%);
            color: #fff;
            min-height: 100vh;
            overflow-x: hidden;
        }

        /* èƒŒæ™¯å’Œæ˜Ÿç©ºæ•ˆæœ */
        #background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: linear-gradient(rgba(10, 25, 47, 0.9), rgba(10, 25, 47, 0.9)), url("https://images.unsplash.com/photo-1511512578047-dfb367046420?ixlib=rb-4.0.3&auto=format&fit=crop&w=2000&q=80");
            background-size: cover;
            background-position: center;
            opacity: 0.7;
            z-index: -2;
        }

        .stars {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }

        .star {
            position: absolute;
            background: #fff;
            border-radius: 50%;
            animation: twinkle 1s infinite;
        }

        @keyframes twinkle {
            0% {
                opacity: 0;
                transform: scale(0);
            }

            50% {
                opacity: 1;
                transform: scale(1);
            }

            100% {
                opacity: 0;
                transform: scale(0);
            }
        }

        /* å¯¼èˆªæ  */
        #daohang {
            display: flex;
            height: 70px;
            align-items: center;
            justify-content: space-between;
            background: rgba(10, 25, 47, 0.9);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            padding: 0 50px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(100, 255, 218, 0.2);
        }

        #daohang li {
            align-items: center;
            font-weight: 600;
            font-size: 16px;
            display: flex;
            flex: 1;
            justify-content: center;
            height: 100%;
            transition: all 0.3s ease;
        }

        #daohang li:hover {
            background: rgba(100, 255, 218, 0.1);
        }

        .line1 {
            display: inline-block;
            height: 30px;
            width: 1px;
            background: rgba(255, 255, 255, 0.3);
        }

        a.daohangTo {
            color: #ccd6f6;
            text-decoration: none;
            padding: 10px 15px;
            border-radius: 4px;
            transition: all 0.3s ease;
            width: 100%;
            text-align: center;
        }

        a.daohangTo:hover {
            color: #64ffda;
            text-shadow: 0 0 10px rgba(100, 255, 218, 0.5);
        }

        a.back {
            color: #ff6b6b;
        }

        a.back:hover {
            color: #ff5252;
            text-shadow: 0 0 10px rgba(255, 107, 107, 0.5);
        }

        /* ä¸»è¦å†…å®¹åŒºåŸŸ */
        .container {
            max-width: 1400px;
            margin: 30px auto;
            padding: 0 20px;
        }

        /* æ ‡ç­¾é¡µæ ·å¼ */
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            background: rgba(23, 42, 70, 0.8);
            border-radius: 15px;
            padding: 10px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.1);
        }

        .tab-btn {
            flex: 1;
            padding: 15px 20px;
            background: transparent;
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 8px;
            color: #ccd6f6;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            text-align: center;
        }

        .tab-btn:hover {
            background: rgba(100, 255, 218, 0.1);
            transform: translateY(-2px);
        }

        .tab-btn.active {
            background: rgba(100, 255, 218, 0.2);
            color: #64ffda;
            border-color: #64ffda;
            box-shadow: 0 5px 15px rgba(100, 255, 218, 0.2);
        }

        /* æ ‡ç­¾å†…å®¹åŒºåŸŸ */
        .tab-content {
            display: none;
            animation: fadeIn 0.5s ease;
            background: rgba(23, 42, 70, 0.8);
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(100, 255, 218, 0.1);
            min-height: 600px;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* æ¦œå•æŸ¥çœ‹æ ·å¼ */
        .platform-selector {
            text-align: center;
            margin-bottom: 30px;
        }

        #platformSelect {
            padding: 12px 30px;
            font-size: 16px;
            background: rgba(10, 25, 47, 0.7);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 8px;
            color: #fff;
            min-width: 250px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        #platformSelect:focus {
            outline: none;
            border-color: #64ffda;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }

        #platformSelect option {
            background: #0a192f;
            color: #fff;
        }

        /* æ¸¸æˆç½‘æ ¼å¸ƒå±€ */
        .game-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 25px;
            margin: 30px 0;
        }

        .game-card {
            background: rgba(10, 25, 47, 0.5);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
            transition: all 0.3s ease;
            border: 1px solid rgba(100, 255, 218, 0.1);
            position: relative;
        }

        .game-card:hover {
            transform: translateY(-10px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.4);
            border-color: rgba(100, 255, 218, 0.3);
        }

        .rank-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            background: rgba(100, 255, 218, 0.2);
            color: #64ffda;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            font-size: 18px;
            z-index: 2;
            border: 2px solid rgba(100, 255, 218, 0.5);
        }

        .rank-badge.top3 {
            background: rgba(255, 215, 0, 0.2);
            color: #ffd700;
            border-color: rgba(255, 215, 0, 0.5);
        }

        .rank-badge.top1 {
            background: rgba(255, 87, 34, 0.2);
            color: #ff5722;
            border-color: rgba(255, 87, 34, 0.5);
        }

        .game-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            border-bottom: 3px solid rgba(100, 255, 218, 0.3);
            transition: all 0.3s ease;
        }

        .game-card:hover .game-img {
            transform: scale(1.05);
        }

        .game-info {
            padding: 20px;
        }

        .game-title {
            color: #64ffda;
            margin-bottom: 10px;
            font-size: 18px;
            font-weight: 600;
            line-height: 1.4;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .game-publisher {
            color: #8892b0;
            font-size: 14px;
            margin-bottom: 5px;
        }

        .game-platform {
            color: #64ffda;
            font-size: 14px;
            font-weight: 500;
            background: rgba(100, 255, 218, 0.1);
            padding: 4px 10px;
            border-radius: 12px;
            display: inline-block;
            margin-top: 10px;
        }

        /* æ•°æ®æ›´æ–°æ ·å¼ */
        .update-form {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-group {
            margin-bottom: 25px;
        }

        .form-group label {
            display: block;
            margin-bottom: 10px;
            color: #64ffda;
            font-weight: 500;
            font-size: 16px;
        }

        .site-select {
            width: 100%;
            padding: 15px;
            background: rgba(10, 25, 47, 0.7);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
            min-height: 200px;
            transition: all 0.3s ease;
        }

        .site-select:focus {
            outline: none;
            border-color: #64ffda;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }

        .site-select option {
            background: #0a192f;
            color: #fff;
            padding: 10px;
            margin: 5px 0;
        }

        .page-params {
            background: rgba(17, 34, 64, 0.7);
            border-radius: 10px;
            padding: 20px;
            margin-top: 20px;
            border: 1px solid rgba(100, 255, 218, 0.1);
        }

        .page-input-group {
            margin-bottom: 15px;
            padding: 15px;
            background: rgba(10, 25, 47, 0.5);
            border-radius: 8px;
            border: 1px solid rgba(100, 255, 218, 0.1);
        }

        .page-input-group label {
            display: inline-block;
            margin-bottom: 10px;
            color: #ccd6f6;
        }

        .page-input {
            width: 100%;
            max-width: 200px;
            padding: 10px 15px;
            background: rgba(10, 25, 47, 0.9);
            border: 1px solid rgba(100, 255, 218, 0.3);
            border-radius: 8px;
            color: #fff;
            font-size: 16px;
        }

        .page-input:focus {
            outline: none;
            border-color: #64ffda;
            box-shadow: 0 0 10px rgba(100, 255, 218, 0.3);
        }

        .submit-btn {
            background: linear-gradient(135deg, #64ffda 0%, #00b894 100%);
            color: #0a192f;
            padding: 15px 40px;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            font-weight: 600;
            transition: all 0.3s ease;
            display: block;
            margin: 30px auto;
            min-width: 200px;
        }

        .submit-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(100, 255, 218, 0.4);
        }

        .submit-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        /* çŠ¶æ€æ¶ˆæ¯ */
        .status-msg {
            padding: 20px;
            margin: 20px 0;
            border-radius: 10px;
            display: none;
            text-align: center;
            border: 1px solid;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .status-msg.success {
            background: rgba(40, 167, 69, 0.1);
            color: #28a745;
            border-color: rgba(40, 167, 69, 0.3);
        }

        .status-msg.error {
            background: rgba(220, 53, 69, 0.1);
            color: #dc3545;
            border-color: rgba(220, 53, 69, 0.3);
        }

        .status-msg.info {
            background: rgba(23, 162, 184, 0.1);
            color: #17a2b8;
            border-color: rgba(23, 162, 184, 0.3);
        }

        /* åŠ è½½çŠ¶æ€ */
        .loading-container {
            text-align: center;
            padding: 60px 20px;
        }

        .loading {
            display: inline-block;
            width: 50px;
            height: 50px;
            border: 3px solid rgba(100, 255, 218, 0.3);
            border-radius: 50%;
            border-top-color: #64ffda;
            animation: spin 1s ease-in-out infinite;
            margin-bottom: 20px;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            color: #64ffda;
            font-size: 16px;
        }

        /* ç©ºçŠ¶æ€ */
        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: #8892b0;
        }

        .empty-icon {
            font-size: 64px;
            margin-bottom: 20px;
            opacity: 0.5;
        }

        /* æ»šåŠ¨æ¡æ ·å¼ */
        .tab-content {
            max-height: 600px;
            overflow-y: auto;
        }

        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: rgba(23, 42, 70, 0.5);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb {
            background: rgba(100, 255, 218, 0.3);
            border-radius: 10px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: rgba(100, 255, 218, 0.5);
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 1200px) {
            .game-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
        }

        @media (max-width: 768px) {
            #daohang {
                flex-wrap: wrap;
                height: auto;
                padding: 10px;
            }

            #daohang li {
                flex: 1 0 33%;
                margin: 5px 0;
            }

            .container {
                padding: 0 15px;
            }

            .tabs {
                flex-direction: column;
            }

            .game-grid {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 15px;
            }

            .tab-content {
                padding: 20px;
                min-height: 500px;
            }

            #platformSelect {
                width: 100%;
            }
        }

        @media (max-width: 480px) {
            .game-grid {
                grid-template-columns: 1fr;
            }

            #daohang li {
                flex: 1 0 50%;
            }
        }
    </style>
</head>

<body>
    <div id="background"></div>
    <div class="stars"></div>

    <ul id="daohang" type="none">
        <li><a class="daohangTo" href="bangdan.html">æ¸¸æˆæ¦œå•</a></li>
        <div class="line1"></div>
        <li><a class="daohangTo" href="lxfb.html">ç±»å‹åˆ†å¸ƒ</a></li>
        <div class="line1"></div>
        <li><a class="daohangTo" href="zhuye.html">é¦–é¡µ</a></li>
        <div class="line1"></div>
        <li><a class="daohangTo" href="Trend.html">å‘å¸ƒæƒ…å†µ</a></li>
        <div class="line1"></div>
        <li><a class="daohangTo" href="Player.html">ç©å®¶</a></li>
        <div class="line1"></div>
        <li><a class="daohangTo" href="Ai.html">AIåˆ†æ</a></li>
        <div class="line1"></div>
        <li><a class="back daohangTo" href="Login.html">é€€å‡º</a></li>
    </ul>

    <div class="container">
        <div class="tabs">
            <button class="tab-btn active" onclick="showTab(0)">æ¦œå•æŸ¥çœ‹</button>
            <button class="tab-btn" onclick="showTab(1)">æ•°æ®æ›´æ–°</button>
        </div>

        <!-- æ¦œå•æŸ¥çœ‹ Tab -->
        <div id="tab1" class="tab-content active">
            <div class="platform-selector">
                <select id="platformSelect">
                    <option value="" disabled selected>é€‰æ‹©æ¸¸æˆå¹³å°</option>
                    <option value="gamespot">Gamespot</option>
                    <option value="3dm">3DM</option>
                    <option value="ign">IGN</option>
                    <option value="youxia">æ¸¸ä¾ ç½‘</option>
                    <option value="6m">Metacritic</option>
                    <option value="ymxk">æ¸¸æ°‘æ˜Ÿç©º</option>
                </select>
            </div>
            <div id="gameList" class="game-grid"></div>

            <!-- åŠ è½½çŠ¶æ€ -->
            <div id="loadingState" class="loading-container" style="display: none;">
                <div class="loading"></div>
                <div class="loading-text">æ­£åœ¨åŠ è½½æ¸¸æˆæ¦œå•...</div>
            </div>

            <!-- ç©ºçŠ¶æ€ -->
            <div id="emptyState" class="empty-state" style="display: none;">
                <div class="empty-icon">ğŸ®</div>
                <h3>æš‚æ— æ•°æ®</h3>
                <p>è¯·é€‰æ‹©ä¸€ä¸ªæ¸¸æˆå¹³å°æŸ¥çœ‹æ¦œå•</p>
            </div>
        </div>

        <!-- æ•°æ®æ›´æ–° Tab -->
        <div id="tab2" class="tab-content">
            <form id="updateForm" class="update-form">
                <div class="form-group">
                    <label>é€‰æ‹©æ›´æ–°ç›®æ ‡ï¼ˆå¯å¤šé€‰ï¼‰ï¼š</label>
                    <select multiple class="site-select" id="siteIds">
                        <option value="3dm">3DM-TOPæ¦œ</option>
                        <option value="gamersky">æ¸¸æ°‘æ˜Ÿç©º-TOPæ¦œ</option>
                        <option value="youxia">æ¸¸ä¾ ç½‘-TOPæ¦œ</option>
                        <option value="gamespot">Gamespot-TOPæ¦œ</option>
                        <option value="ign">IGN-TOPæ¦œ</option>
                        <option value="metacritic">Metacritic-TOPæ¦œ</option>
                        <option value="3dmtype">3DM-æ¸¸æˆåº“</option>
                        <option value="gamerskytype">æ¸¸æ°‘æ˜Ÿç©º-æ¸¸æˆåº“</option>
                    </select>
                </div>

                <div id="pageParams" class="page-params"></div>

                <div class="form-group">
                    <button type="submit" class="submit-btn">ç«‹å³æ›´æ–°</button>
                </div>
            </form>
            <div id="statusMsg" class="status-msg"></div>
        </div>
    </div>

    <script>
        // åˆå§‹åŒ–æ˜Ÿç©ºèƒŒæ™¯
        function initStars() {
            const stars = document.querySelector('.stars');
            for (let i = 0; i < 150; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.top = Math.random() * 100 + 'vh';
                star.style.left = Math.random() * 100 + 'vw';
                star.style.width = Math.random() * 3 + 1 + 'px';
                star.style.height = star.style.width;
                star.style.animationDuration = Math.random() * 3 + 1 + 's';
                star.style.animationDelay = Math.random() * 2 + 's';
                stars.appendChild(star);
            }
        }

        // Tabåˆ‡æ¢åŠŸèƒ½
        function showTab(index) {
            document.querySelectorAll('.tab-content').forEach((tab, i) => {
                tab.classList.toggle('active', i === index);
                document.querySelectorAll('.tab-btn')[i].classList.toggle('active', i === index);
            });

            // æ›´æ–°URLå‚æ•°
            history.replaceState(null, null, `#${index === 0 ? 'list' : 'update'}`);
        }

        // ä»URLä¸­æ¢å¤TabçŠ¶æ€
        function restoreTabFromUrl() {
            const hash = window.location.hash;
            if (hash === '#update') {
                showTab(1);
            } else {
                showTab(0);
            }
        }

        // æ¦œå•æŸ¥çœ‹é€»è¾‘
        const platformSelect = document.getElementById('platformSelect');
        const gameList = document.getElementById('gameList');
        const loadingState = document.getElementById('loadingState');
        const emptyState = document.getElementById('emptyState');

        // å¹³å°æ˜¾ç¤ºåç§°æ˜ å°„
        const platformNames = {
            'gamespot': 'Gamespot',
            '3dm': '3DM',
            'ign': 'IGN',
            'youxia': 'æ¸¸ä¾ ç½‘',
            '6m': 'Metacritic',
            'ymxk': 'æ¸¸æ°‘æ˜Ÿç©º'
        };

        platformSelect.addEventListener('change', async (e) => {
            const platform = e.target.value;
            if (platform) {
                await fetchGames(platform);
            }
        });

        async function fetchGames(platform) {
            try {
                // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
                gameList.innerHTML = '';
                loadingState.style.display = 'block';
                emptyState.style.display = 'none';

                const response = await fetch(`http://47.109.22.23:8082/listtop?platform=${platform}`);
                if (!response.ok) throw new Error('è¯·æ±‚å¤±è´¥');

                const { code, msg, data } = await response.json();
                if (code !== 1) throw new Error(msg || 'æ•°æ®è·å–å¤±è´¥');

                renderGames(platform, data);
            } catch (error) {
                gameList.innerHTML = `<div class="error-msg">âŒ ${error.message}</div>`;
                emptyState.innerHTML = `
                    <div class="empty-icon">âš ï¸</div>
                    <h3>åŠ è½½å¤±è´¥</h3>
                    <p>${error.message}</p>
                `;
                emptyState.style.display = 'block';
            } finally {
                loadingState.style.display = 'none';
            }
        }

        function renderGames(platform, games) {
            if (!games || games.length === 0) {
                emptyState.style.display = 'block';
                gameList.innerHTML = '';
                return;
            }

            emptyState.style.display = 'none';
            gameList.innerHTML = games.map((game, index) => {
                // ç”Ÿæˆæ’åå¾½ç« ç±»å
                let rankClass = 'rank-badge';
                if (index === 0) rankClass += ' top1';
                else if (index < 3) rankClass += ' top3';

                return `
                    <div class="game-card">
                        <div class="${rankClass}">${index + 1}</div>
                        <img src="${game[2]}" alt="${game[0]}" class="game-img" loading="lazy" 
                             onerror="this.src='https://via.placeholder.com/300x200?text=æ¸¸æˆå°é¢'">
                        <div class="game-info">
                            <h3 class="game-title">${game[0]}</h3>
                            <div class="game-publisher">å‘è¡Œå•†ï¼š${game[1] || 'æœªçŸ¥'}</div>
                            <div class="game-platform">${platformNames[platform] || platform}</div>
                        </div>
                    </div>
                `;
            }).join('');
        }

        // æ•°æ®æ›´æ–°é€»è¾‘
        const updateForm = document.getElementById('updateForm');
        const siteIds = document.getElementById('siteIds');
        const pageParamsContainer = document.getElementById('pageParams');
        const statusMsg = document.getElementById('statusMsg');

        // å‚æ•°æ˜ å°„é…ç½®
        const paramConfig = {
            '3dmtype': {
                param: 'page_count_3dm',
                label: '3DMæ¸¸æˆåº“é¡µæ•°',
                default: 1
            },
            'gamerskytype': {
                param: 'page_count_gamersky',
                label: 'æ¸¸æ°‘æ˜Ÿç©ºé¡µæ•°',
                default: 1
            }
        };

        siteIds.addEventListener('change', updatePageParams);

        function updatePageParams() {
            pageParamsContainer.innerHTML = '';
            const selected = Array.from(siteIds.selectedOptions).map(o => o.value);

            selected.forEach(site => {
                if (paramConfig[site]) {
                    const config = paramConfig[site];
                    const div = document.createElement('div');
                    div.className = 'page-input-group';
                    div.innerHTML = `
                        <label>${config.label}ï¼š</label>
                        <input type="number" 
                               min="1" 
                               max="50"
                               value="${config.default}" 
                               class="page-input" 
                               id="${config.param}"
                               placeholder="è¯·è¾“å…¥é¡µæ•° (1-50)">
                    `;
                    pageParamsContainer.appendChild(div);
                }
            });

            // å¦‚æœæ²¡æœ‰éœ€è¦å‚æ•°çš„é€‰é¡¹ï¼Œéšè—å‚æ•°åŒºåŸŸ
            pageParamsContainer.style.display = selected.some(site => paramConfig[site]) ? 'block' : 'none';
        }

        updateForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const submitBtn = updateForm.querySelector('.submit-btn');
            const originalText = submitBtn.textContent;

            const selectedSites = Array.from(siteIds.selectedOptions).map(o => o.value);
            if (!selectedSites.length) {
                showStatus('è¯·è‡³å°‘é€‰æ‹©ä¸€ä¸ªæ›´æ–°ç›®æ ‡', 'error');
                return;
            }

            // ç¦ç”¨æäº¤æŒ‰é’®å¹¶æ˜¾ç¤ºåŠ è½½çŠ¶æ€
            submitBtn.disabled = true;
            submitBtn.textContent = 'æ›´æ–°ä¸­...';

            const params = new URLSearchParams({
                site_ids: selectedSites.join(',')
            });

            // æ·»åŠ åˆ†é¡µå‚æ•°
            selectedSites.forEach(site => {
                const config = paramConfig[site];
                if (config) {
                    const input = document.getElementById(config.param);
                    const value = Math.max(1, Math.min(50, parseInt(input.value) || config.default));
                    params.append(config.param, value);
                }
            });

            try {
                showStatus('æ­£åœ¨æ›´æ–°æ•°æ®ï¼Œè¯·ç¨å€™...', 'info');

                const response = await fetch(`http://47.109.22.23:8082/updategames?${params.toString()}`);
                if (!response.ok) throw new Error(`HTTPé”™è¯¯: ${response.status}`);

                const { code, msg } = await response.json();

                if (code === 1) {
                    showStatus(`âœ… æ›´æ–°æˆåŠŸï¼š${msg}`, 'success');

                    // å¦‚æœæ­£åœ¨æŸ¥çœ‹æ¦œå•ï¼Œè‡ªåŠ¨åˆ·æ–°å½“å‰é€‰ä¸­çš„å¹³å°
                    const currentPlatform = platformSelect.value;
                    if (currentPlatform && document.querySelector('.tab-btn.active').textContent === 'æ¦œå•æŸ¥çœ‹') {
                        setTimeout(() => fetchGames(currentPlatform), 1000);
                    }
                } else {
                    showStatus(`âŒ æ›´æ–°å¤±è´¥ï¼š${msg}`, 'error');
                }
            } catch (error) {
                console.error('æ›´æ–°é”™è¯¯:', error);
                showStatus(`âŒ æ›´æ–°å¤±è´¥ï¼š${error.message}`, 'error');
            } finally {
                // æ¢å¤æäº¤æŒ‰é’®
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;

                // 5ç§’åè‡ªåŠ¨éšè—æˆåŠŸ/é”™è¯¯æ¶ˆæ¯
                setTimeout(() => {
                    statusMsg.style.display = 'none';
                }, 5000);
            }
        });

        function showStatus(message, type) {
            statusMsg.textContent = message;
            statusMsg.className = `status-msg ${type}`;
            statusMsg.style.display = 'block';
        }

        // é¡µé¢åˆå§‹åŒ–
        function initPage() {
            initStars();
            restoreTabFromUrl();
            updatePageParams();

            // ç›‘å¬URLå˜åŒ–
            window.addEventListener('hashchange', restoreTabFromUrl);

            // è®¾ç½®è¡¨å•è¾“å…¥æ¡†æ ·å¼
            const inputs = document.querySelectorAll('input, select');
            inputs.forEach(input => {
                input.addEventListener('focus', function () {
                    this.style.background = 'rgba(10, 25, 47, 0.9)';
                });

                input.addEventListener('blur', function () {
                    this.style.background = 'rgba(10, 25, 47, 0.7)';
                });
            });

            // æ˜¾ç¤ºåˆå§‹çŠ¶æ€
            emptyState.style.display = 'block';
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', initPage);
    </script>
</body>

</html>